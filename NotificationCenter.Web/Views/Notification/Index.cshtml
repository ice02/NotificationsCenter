
@{
    ViewData["Title"] = "Notifications";
}

<link href="~/froala-editor/css/froala_editor.pkgd.min.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="~/froala-editor/js/froala_editor.pkgd.min.js"></script>

<div class="row">
    <div class="col-xl-6 mb-5 mb-xl-0">
        <div class="card shadow">
            <div class="card-header bg-transparent">
                <h3 class="mb-0">Notifications</h3>
            </div>
            <div class="card-body">
                <div id="editor"></div>
            </div>
        </div>
    </div>

    <div class="col-xl-6 mb-5 mb-xl-0">
        <div class="row">
            <div class="col-xl-12 mb-5 mb-xl-0">
                <div class="card shadow">
                    <div class="card-header bg-transparent">
                        <h3 class="mb-0">Collection</h3>
                    </div>
                    <div class="card-body">
                        
                        <div class="dropdown-menu dropdown-menu-arrow ">
                            <div class=" dropdown-header noti-title">
                                <h6 class="text-overflow m-0">Select a collection to send</h6>
                            </div>
                            <ul>
                                <li>First</li>
                                <li>Second</li>
                                <li>Third</li>
                                <li>Quatro</li>
                            </ul>
                        </div>
                        test
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xl-12 mb-5 mb-xl-0">
                <div class="card shadow">
                    <div class="card-header bg-transparent">
                        <h3 class="mb-0">Commands</h3>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary my-4" id="previewBtn">Show preview</button>
                        <button class="btn btn-primary my-4" type="submit" id="sendBtn">Send notification</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
            var editor = new FroalaEditor('#editor', {
                heightMin: 500,
                heightMax: 700
            })
</script>

<script>
            let editor = new FroalaEditor('div#froala-editor', {}, function () {
                console.log(editor.html.get())
            });
</script>

<script>

    var socket = null;

    (function () {

        console.log("Starting websocket.");

        var userName = '@User.Identity.Name'.replace("\\", "-");;


        var webSocketURI = "ws://localhost:8888/" + userName + "/";
        var webSocketURIOld = "ws://localhost:8888/Toolbox/";

        console.log("Starting for uri " + webSocketURI);

        socket = new WebSocket(webSocketURI);

        socket.onopen = function () {
            console.log("Connected.");
        };

        socket.onclose = function (event) {
            if (event.wasClean) {
                console.log('Disconnected.');
            } else {
                console.log('Connection lost.'); // for example if server processes is killed
                // try to reconnect on old uri
                console.log("Error, trying with uri " + webSocketURIOld);
                socket = new WebSocket(webSocketURIOld);
            }
            console.log('Code: ' + event.code + '. Reason: ' + event.reason);
        };

        socket.onmessage = function (event) {
            console.log("Data received: " + event.data);
        };

        socket.onerror = function (error) {
            console.log("Error: " + error.message);
        };

        $("#previewBtn").click(function () {
            console.log("Click on preview button");

            socket.send('test');
            return false;

            var form = document.getElementById('form');
            var message = document.getElementById('message');
            form.onsubmit = function () {
                socket.send(message.value);
                message.value = '';
                return false;
            };
        });

        $("#sendBtn").click(function () {
            console.log("Click on send button");

            var form = document.getElementById('form');
            var message = document.getElementById('message');
            form.onsubmit = function () {
                socket.send(message.value);
                message.value = '';
                return false;
            };
        });

    })();

</script>
